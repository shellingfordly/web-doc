"use strict";(self.webpackChunkweb_doc=self.webpackChunkweb_doc||[]).push([[858],{8107:(n,s,e)=>{e.r(s),e.d(s,{data:()=>a});const a={key:"v-7a6d4294",path:"/frame/react/props.html",title:"",lang:"en-US",frontmatter:{categories:["frame","react"]},excerpt:"",headers:[{level:2,title:"观察者模式",slug:"观察者模式",children:[{level:3,title:"EventBus",slug:"eventbus",children:[]}]}]}},2244:(n,s,e)=>{e.r(s),e.d(s,{default:()=>l});const a=(0,e(6252).uE)('<h2 id="观察者模式" tabindex="-1"><a class="header-anchor" href="#观察者模式" aria-hidden="true">#</a> 观察者模式</h2><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>class EventBus {\n  constructor() {\n    this.bus = document.createElement(&quot;fakeelement&quot;);\n  }\n\n  addEventListener(event, callback) {\n    this.bus.addEventListener(event, callback);\n  }\n\n  removeEventListener(event, callback) {\n    this.bus.removeEventListener(event, callback);\n  }\n\n  dispatchEvent(event, detail = {}) {\n    this.bus.dispatchEvent(new CustomEvent(event, { detail }));\n  }\n}\n\nexport default new EventBus();\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><ul><li>使用</li></ul><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>import EventBus from &#39;./EventBus&#39;\nclass ComponentA extends React.Component {\n  componentDidMount() {\n      EventBus.addEventListener(&#39;myEvent&#39;, this.handleEvent)\n  }\n  componentWillUnmount() {\n      EventBus.removeEventListener(&#39;myEvent&#39;, this.handleEvent)\n  }\n\n  handleEvent = (e) =&gt; {\n      console.log(e.detail.log)  //i&#39;m zach\n  }\n}\nclass ComponentB extends React.Component {\n  sendEvent = () =&gt; {\n      EventBus.dispatchEvent(&#39;myEvent&#39;, {log: &quot;i&#39;m zach&quot;}))\n  }\n\n  render() {\n      return &lt;button onClick={this.sendEvent}&gt;Send&lt;/button&gt;\n  }\n}\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="eventbus" tabindex="-1"><a class="header-anchor" href="#eventbus" aria-hidden="true">#</a> EventBus</h3><div class="language-javascript ext-js line-numbers-mode"><pre class="language-javascript"><code>function EventBus() {\n  const subscriptions = {};\n  this.subscribe = (eventType, callback) =&gt; {\n    const id = Symbol(&quot;id&quot;);\n    if (!subscriptions[eventType]) subscriptions[eventType] = {};\n    subscriptions[eventType][id] = callback;\n    return {\n      unsubscribe: function unsubscribe() {\n        delete subscriptions[eventType][id];\n        if (\n          Object.getOwnPropertySymbols(subscriptions[eventType]).length === 0\n        ) {\n          delete subscriptions[eventType];\n        }\n      },\n    };\n  };\n\n  this.publish = (eventType, arg) =&gt; {\n    if (!subscriptions[eventType]) return;\n\n    Object.getOwnPropertySymbols(subscriptions[eventType]).forEach((key) =&gt;\n      subscriptions[eventType][key](arg)\n    );\n  };\n}\nexport default EventBus;\n</code></pre><div class="line-numbers"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div>',6),r={},l=(0,e(3744).Z)(r,[["render",function(n,s){return a}]])},3744:(n,s)=>{s.Z=(n,s)=>{const e=n.__vccOpts||n;for(const[n,a]of s)e[n]=a;return e}}}]);